<?php

/**
 * @file
 * Example module for the RESTful AngularJs module.
 *
 * Demonstrate the use of AngularJs forms instead of Form API, along with
 * RESTful endpoint and the entity validator module.
 */

/**
 * Implements hook_menu().
 */
function restful_angular_example_menu() {
  $items['restful-example/form'] = array(
    'title' => 'AngularJs Form',
    'access callback' => 'restful_angular_example_form_access',
    'page callback' => 'restful_angular_example_form',
  );
  return $items;
}

/**
 * Implements hook_theme().
 */
function restful_angular_example_theme() {
  $theme['restful_angular_example_angular_form'] = array(
    'template' => 'restful-angular-form',
    'path' => drupal_get_path('module', 'restful_angular_example') . '/templates',
    'variables' => array(),
  );

  return $theme;

}

/**
 * Access callback; Determine if user can access the form.
 */
function restful_angular_example_form_access() {
  return node_access('create', 'article');
}

/**
 * Page callback; Load the AngularJs form.
 */
function restful_angular_example_form() {
  $bower_path = drupal_get_path('module', 'restful_angular_example') . '/components/restful-app/bower_components';

  // Load the libraries.
  drupal_add_js($bower_path . '/danialfarid-angular-file-upload/dist/angular-file-upload-shim.min.js');
  drupal_add_js($bower_path . '/angular/angular.js');
  drupal_add_js($bower_path . '/danialfarid-angular-file-upload/dist/angular-file-upload.min.js');

  // Load our custom app.
  drupal_add_js(drupal_get_path('module', 'restful_angular_example') . '/components/restful-app/dist/restful-app.js');

  // Pass info via Drupal.settings.
  $settings['restfulExample'] = array(
    'basePath' => url('', array('absolute' => TRUE)),
    'csrfToken' => drupal_get_token('rest'),
    'data' => array(
      'article' => array(
        'label' => 'no',
      ),
    ),
  );

  drupal_add_js($settings, 'setting');

  return theme('restful_angular_example_angular_form');
}
